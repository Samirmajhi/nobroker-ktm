{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\aghim\\\\no-broker-kathmandu\\\\frontend\\\\src\\\\pages\\\\MessagesPage.tsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from 'react';\nimport { useSelector } from 'react-redux';\nimport ChatInterface from '../components/messaging/ChatInterface';\nimport NewConversationButton from '../components/messaging/NewConversationButton';\nimport { MessageSquare, Search, Plus } from 'lucide-react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport messagingService from '../services/messagingService';\nimport { toast } from 'react-hot-toast';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst MessagesPage = () => {\n  _s();\n  const {\n    user\n  } = useSelector(state => state.auth);\n  const [conversations, setConversations] = useState([]);\n  const [selectedConversation, setSelectedConversation] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [searchTerm, setSearchTerm] = useState('');\n  const [filterType, setFilterType] = useState('all');\n  useEffect(() => {\n    fetchConversations();\n    setupRealTimeUpdates();\n  }, []);\n  const setupRealTimeUpdates = () => {\n    messagingService.connect();\n\n    // Handle new messages to update conversation list\n    const unsubscribeMessage = messagingService.onNewMessage(message => {\n      // Update the conversation in the list\n      setConversations(prev => prev.map(conv => conv.conversation_id === message.conversation_id ? {\n        ...conv,\n        last_message: message.message_text,\n        last_message_time: message.created_at,\n        last_message_sender_id: message.sender_id,\n        unread_count: conv.unread_count + (message.sender_id !== (user === null || user === void 0 ? void 0 : user.user_id) ? 1 : 0)\n      } : conv));\n    });\n    return () => {\n      unsubscribeMessage();\n    };\n  };\n  const fetchConversations = async () => {\n    try {\n      setLoading(true);\n      const token = localStorage.getItem('token');\n      const response = await fetch('http://localhost:5000/api/messages/conversations', {\n        headers: {\n          'Authorization': `Bearer ${token}`,\n          'Content-Type': 'application/json'\n        }\n      });\n      if (response.ok) {\n        const data = await response.json();\n        setConversations(data.conversations || []);\n      }\n    } catch (error) {\n      console.error('Error fetching conversations:', error);\n      toast.error('Failed to load conversations');\n    } finally {\n      setLoading(false);\n    }\n  };\n  const filteredConversations = conversations.filter(conv => {\n    const matchesSearch = conv.other_participant_name.toLowerCase().includes(searchTerm.toLowerCase()) || conv.listing_title.toLowerCase().includes(searchTerm.toLowerCase());\n    if (!matchesSearch) return false;\n    switch (filterType) {\n      case 'unread':\n        return conv.unread_count > 0;\n      case 'owners':\n        return conv.other_participant_role === 'owner';\n      case 'tenants':\n        return conv.other_participant_role === 'tenant';\n      default:\n        return true;\n    }\n  });\n  const formatLastMessageTime = timestamp => {\n    if (!timestamp) return '';\n    const date = new Date(timestamp);\n    const now = new Date();\n    const diffInHours = (now.getTime() - date.getTime()) / (1000 * 60 * 60);\n    if (diffInHours < 24) {\n      return date.toLocaleTimeString([], {\n        hour: '2-digit',\n        minute: '2-digit'\n      });\n    } else if (diffInHours < 168) {\n      // 7 days\n      return date.toLocaleDateString([], {\n        weekday: 'short'\n      });\n    } else {\n      return date.toLocaleDateString([], {\n        month: 'short',\n        day: 'numeric'\n      });\n    }\n  };\n  const handleConversationSelect = conversation => {\n    setSelectedConversation(conversation);\n\n    // Mark conversation as read when selected\n    if (conversation.unread_count > 0) {\n      markConversationAsRead(conversation.conversation_id);\n    }\n  };\n  const markConversationAsRead = async conversationId => {\n    try {\n      const token = localStorage.getItem('token');\n      await fetch(`http://localhost:5000/api/messages/conversations/${conversationId}/read`, {\n        method: 'PUT',\n        headers: {\n          'Authorization': `Bearer ${token}`,\n          'Content-Type': 'application/json'\n        }\n      });\n\n      // Update local state\n      setConversations(prev => prev.map(conv => conv.conversation_id === conversationId ? {\n        ...conv,\n        unread_count: 0\n      } : conv));\n    } catch (error) {\n      console.error('Error marking conversation as read:', error);\n    }\n  };\n  const getTotalUnreadCount = () => {\n    return conversations.reduce((total, conv) => total + conv.unread_count, 0);\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"min-h-screen bg-gradient-to-br from-gray-50 to-blue-50\",\n    children: [/*#__PURE__*/_jsxDEV(motion.div, {\n      initial: {\n        opacity: 0,\n        y: -20\n      },\n      animate: {\n        opacity: 1,\n        y: 0\n      },\n      className: \"bg-white shadow-lg border-b border-gray-200\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-center justify-between\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex items-center space-x-4\",\n            children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n              className: \"text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent\",\n              children: \"Messages\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 170,\n              columnNumber: 15\n            }, this), getTotalUnreadCount() > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"bg-red-500 text-white text-sm px-3 py-1 rounded-full font-medium\",\n              children: [getTotalUnreadCount(), \" new\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 174,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 169,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex items-center space-x-3\",\n            children: /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: () => {\n                // This will be handled by the floating action button\n                toast.info('Use the + button to start a new conversation');\n              },\n              className: \"flex items-center px-4 py-2 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg hover:from-blue-700 hover:to-purple-700 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:scale-105\",\n              children: [/*#__PURE__*/_jsxDEV(Plus, {\n                className: \"w-4 h-4 mr-2\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 187,\n                columnNumber: 17\n              }, this), \"New Chat\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 180,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 179,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 168,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 167,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 162,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"grid grid-cols-1 lg:grid-cols-3 gap-6 h-[calc(100vh-200px)]\",\n        children: [/*#__PURE__*/_jsxDEV(motion.div, {\n          initial: {\n            opacity: 0,\n            x: -20\n          },\n          animate: {\n            opacity: 1,\n            x: 0\n          },\n          className: \"lg:col-span-1 bg-white rounded-xl shadow-lg border border-gray-200\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"p-4 border-b border-gray-200\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"relative mb-4\",\n              children: [/*#__PURE__*/_jsxDEV(Search, {\n                className: \"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 205,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                type: \"text\",\n                placeholder: \"Search conversations...\",\n                value: searchTerm,\n                onChange: e => setSearchTerm(e.target.value),\n                className: \"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 206,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 204,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex space-x-1 bg-gray-100 p-1 rounded-lg\",\n              children: [{\n                key: 'all',\n                label: 'All',\n                count: conversations.length\n              }, {\n                key: 'unread',\n                label: 'Unread',\n                count: conversations.filter(c => c.unread_count > 0).length\n              }, {\n                key: 'owners',\n                label: 'Owners',\n                count: conversations.filter(c => c.other_participant_role === 'owner').length\n              }, {\n                key: 'tenants',\n                label: 'Tenants',\n                count: conversations.filter(c => c.other_participant_role === 'tenant').length\n              }].map(filter => /*#__PURE__*/_jsxDEV(\"button\", {\n                onClick: () => setFilterType(filter.key),\n                className: `flex-1 px-3 py-2 text-sm font-medium rounded-md transition-all duration-200 ${filterType === filter.key ? 'bg-white text-blue-600 shadow-sm' : 'text-gray-600 hover:text-gray-900'}`,\n                children: [filter.label, filter.count > 0 && /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"ml-1 text-xs bg-gray-200 text-gray-600 px-2 py-1 rounded-full\",\n                  children: filter.count\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 234,\n                  columnNumber: 23\n                }, this)]\n              }, filter.key, true, {\n                fileName: _jsxFileName,\n                lineNumber: 223,\n                columnNumber: 19\n              }, this))\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 216,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 203,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"overflow-y-auto h-[calc(100%-140px)]\",\n            children: loading ? /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex justify-center items-center h-full\",\n              children: /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 246,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 245,\n              columnNumber: 17\n            }, this) : filteredConversations.length === 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex flex-col items-center justify-center h-full text-gray-500 p-8\",\n              children: [/*#__PURE__*/_jsxDEV(MessageSquare, {\n                className: \"w-16 h-16 mb-4 text-gray-300\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 250,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                className: \"text-lg font-medium mb-2\",\n                children: \"No conversations found\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 251,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                className: \"text-sm text-center\",\n                children: searchTerm || filterType !== 'all' ? 'Try adjusting your search or filters' : 'Start a conversation about a property'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 252,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 249,\n              columnNumber: 17\n            }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"divide-y divide-gray-100\",\n              children: /*#__PURE__*/_jsxDEV(AnimatePresence, {\n                children: filteredConversations.map((conversation, index) => /*#__PURE__*/_jsxDEV(motion.button, {\n                  initial: {\n                    opacity: 0,\n                    y: 20\n                  },\n                  animate: {\n                    opacity: 1,\n                    y: 0\n                  },\n                  transition: {\n                    delay: index * 0.05\n                  },\n                  onClick: () => handleConversationSelect(conversation),\n                  className: `w-full p-4 text-left hover:bg-gray-50 transition-all duration-200 ${(selectedConversation === null || selectedConversation === void 0 ? void 0 : selectedConversation.conversation_id) === conversation.conversation_id ? 'bg-blue-50 border-r-4 border-blue-600' : ''}`,\n                  children: /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"flex items-start space-x-3\",\n                    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                      className: \"relative\",\n                      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                        className: \"w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-medium flex-shrink-0\",\n                        children: conversation.other_participant_avatar ? /*#__PURE__*/_jsxDEV(\"img\", {\n                          src: conversation.other_participant_avatar,\n                          alt: conversation.other_participant_name,\n                          className: \"w-12 h-12 rounded-full object-cover\"\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 279,\n                          columnNumber: 33\n                        }, this) : conversation.other_participant_name.charAt(0).toUpperCase()\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 277,\n                        columnNumber: 29\n                      }, this), conversation.unread_count > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n                        className: \"absolute -top-1 -right-1 bg-red-500 text-white text-xs px-2 py-1 rounded-full min-w-[20px] text-center\",\n                        children: conversation.unread_count\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 289,\n                        columnNumber: 31\n                      }, this)]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 276,\n                      columnNumber: 27\n                    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                      className: \"flex-1 min-w-0\",\n                      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                        className: \"flex items-center justify-between mb-1\",\n                        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n                          className: \"font-semibold text-gray-900 truncate\",\n                          children: conversation.other_participant_name\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 296,\n                          columnNumber: 31\n                        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                          className: \"text-xs text-gray-500 flex-shrink-0\",\n                          children: formatLastMessageTime(conversation.last_message_time)\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 299,\n                          columnNumber: 31\n                        }, this)]\n                      }, void 0, true, {\n                        fileName: _jsxFileName,\n                        lineNumber: 295,\n                        columnNumber: 29\n                      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                        className: \"text-sm text-gray-600 truncate mb-1\",\n                        children: conversation.listing_title\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 303,\n                        columnNumber: 29\n                      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                        className: \"flex items-center justify-between\",\n                        children: [conversation.last_message && /*#__PURE__*/_jsxDEV(\"p\", {\n                          className: \"text-sm text-gray-500 truncate flex-1\",\n                          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                            className: conversation.last_message_sender_id === (user === null || user === void 0 ? void 0 : user.user_id) ? 'text-blue-600 font-medium' : '',\n                            children: conversation.last_message_sender_id === (user === null || user === void 0 ? void 0 : user.user_id) ? 'You: ' : ''\n                          }, void 0, false, {\n                            fileName: _jsxFileName,\n                            lineNumber: 309,\n                            columnNumber: 35\n                          }, this), conversation.last_message]\n                        }, void 0, true, {\n                          fileName: _jsxFileName,\n                          lineNumber: 308,\n                          columnNumber: 33\n                        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                          className: \"flex items-center space-x-2 ml-2\",\n                          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                            className: `text-xs px-2 py-1 rounded-full ${conversation.other_participant_role === 'owner' ? 'bg-green-100 text-green-700' : 'bg-blue-100 text-green-700'}`,\n                            children: conversation.other_participant_role === 'owner' ? 'Owner' : 'Tenant'\n                          }, void 0, false, {\n                            fileName: _jsxFileName,\n                            lineNumber: 316,\n                            columnNumber: 33\n                          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                            className: \"text-sm font-medium text-gray-900\",\n                            children: [\"\\u20B9\", conversation.listing_price.toLocaleString()]\n                          }, void 0, true, {\n                            fileName: _jsxFileName,\n                            lineNumber: 323,\n                            columnNumber: 33\n                          }, this)]\n                        }, void 0, true, {\n                          fileName: _jsxFileName,\n                          lineNumber: 315,\n                          columnNumber: 31\n                        }, this)]\n                      }, void 0, true, {\n                        fileName: _jsxFileName,\n                        lineNumber: 306,\n                        columnNumber: 29\n                      }, this)]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 294,\n                      columnNumber: 27\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 275,\n                    columnNumber: 25\n                  }, this)\n                }, conversation.conversation_id, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 263,\n                  columnNumber: 23\n                }, this))\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 261,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 260,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 243,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 198,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(motion.div, {\n          initial: {\n            opacity: 0,\n            x: 20\n          },\n          animate: {\n            opacity: 1,\n            x: 0\n          },\n          className: \"lg:col-span-2 bg-white rounded-xl shadow-lg border border-gray-200\",\n          children: selectedConversation ? /*#__PURE__*/_jsxDEV(ChatInterface, {\n            conversationId: selectedConversation.conversation_id,\n            otherParticipant: {\n              name: selectedConversation.other_participant_name,\n              avatar: selectedConversation.other_participant_avatar,\n              id: selectedConversation.other_participant_id,\n              role: selectedConversation.other_participant_role\n            },\n            listingId: selectedConversation.listing_id\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 345,\n            columnNumber: 15\n          }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex flex-col items-center justify-center h-full text-gray-500 p-8\",\n            children: [/*#__PURE__*/_jsxDEV(MessageSquare, {\n              className: \"w-20 h-20 mb-6 text-gray-300\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 357,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"h3\", {\n              className: \"text-xl font-semibold mb-3 text-gray-700\",\n              children: \"Select a conversation\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 358,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"text-center text-gray-500 max-w-md\",\n              children: \"Choose a conversation from the list to start messaging. You can search, filter, and manage all your property-related conversations here.\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 359,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 356,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 339,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 196,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 195,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(NewConversationButton, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 370,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 160,\n    columnNumber: 5\n  }, this);\n};\n_s(MessagesPage, \"KNe0Vs710C6SMkZchl8pU71WsjE=\", false, function () {\n  return [useSelector];\n});\n_c = MessagesPage;\nexport default MessagesPage;\nvar _c;\n$RefreshReg$(_c, \"MessagesPage\");","map":{"version":3,"names":["React","useState","useEffect","useSelector","ChatInterface","NewConversationButton","MessageSquare","Search","Plus","motion","AnimatePresence","messagingService","toast","jsxDEV","_jsxDEV","MessagesPage","_s","user","state","auth","conversations","setConversations","selectedConversation","setSelectedConversation","loading","setLoading","searchTerm","setSearchTerm","filterType","setFilterType","fetchConversations","setupRealTimeUpdates","connect","unsubscribeMessage","onNewMessage","message","prev","map","conv","conversation_id","last_message","message_text","last_message_time","created_at","last_message_sender_id","sender_id","unread_count","user_id","token","localStorage","getItem","response","fetch","headers","ok","data","json","error","console","filteredConversations","filter","matchesSearch","other_participant_name","toLowerCase","includes","listing_title","other_participant_role","formatLastMessageTime","timestamp","date","Date","now","diffInHours","getTime","toLocaleTimeString","hour","minute","toLocaleDateString","weekday","month","day","handleConversationSelect","conversation","markConversationAsRead","conversationId","method","getTotalUnreadCount","reduce","total","className","children","div","initial","opacity","y","animate","fileName","_jsxFileName","lineNumber","columnNumber","onClick","info","x","type","placeholder","value","onChange","e","target","key","label","count","length","c","index","button","transition","delay","other_participant_avatar","src","alt","charAt","toUpperCase","listing_price","toLocaleString","otherParticipant","name","avatar","id","other_participant_id","role","listingId","listing_id","_c","$RefreshReg$"],"sources":["C:/Users/aghim/no-broker-kathmandu/frontend/src/pages/MessagesPage.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { useSelector } from 'react-redux';\r\nimport { RootState } from '../store/store';\r\nimport ChatInterface from '../components/messaging/ChatInterface';\r\nimport NewConversationButton from '../components/messaging/NewConversationButton';\r\nimport { MessageSquare, Search, Plus, Bell, Filter } from 'lucide-react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport messagingService from '../services/messagingService';\r\nimport { toast } from 'react-hot-toast';\r\n\r\ninterface Conversation {\r\n  conversation_id: string;\r\n  listing_id: string;\r\n  listing_title: string;\r\n  listing_price: number;\r\n  owner_id: string;\r\n  other_participant_name: string;\r\n  other_participant_id: string;\r\n  other_participant_avatar?: string;\r\n  other_participant_role?: string;\r\n  last_message?: string;\r\n  last_message_time?: string;\r\n  last_message_sender_id?: string;\r\n  unread_count: number;\r\n}\r\n\r\nconst MessagesPage: React.FC = () => {\r\n  const { user } = useSelector((state: RootState) => state.auth);\r\n  const [conversations, setConversations] = useState<Conversation[]>([]);\r\n  const [selectedConversation, setSelectedConversation] = useState<Conversation | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [filterType, setFilterType] = useState<'all' | 'unread' | 'owners' | 'tenants'>('all');\r\n\r\n  useEffect(() => {\r\n    fetchConversations();\r\n    setupRealTimeUpdates();\r\n  }, []);\r\n\r\n  const setupRealTimeUpdates = () => {\r\n    messagingService.connect();\r\n\r\n    // Handle new messages to update conversation list\r\n    const unsubscribeMessage = messagingService.onNewMessage((message) => {\r\n      // Update the conversation in the list\r\n      setConversations(prev => \r\n        prev.map(conv => \r\n          conv.conversation_id === message.conversation_id\r\n            ? {\r\n                ...conv,\r\n                last_message: message.message_text,\r\n                last_message_time: message.created_at,\r\n                last_message_sender_id: message.sender_id,\r\n                unread_count: conv.unread_count + (message.sender_id !== user?.user_id ? 1 : 0)\r\n              }\r\n            : conv\r\n        )\r\n      );\r\n    });\r\n\r\n    return () => {\r\n      unsubscribeMessage();\r\n    };\r\n  };\r\n\r\n  const fetchConversations = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const token = localStorage.getItem('token');\r\n      const response = await fetch('http://localhost:5000/api/messages/conversations', {\r\n        headers: {\r\n          'Authorization': `Bearer ${token}`,\r\n          'Content-Type': 'application/json'\r\n        }\r\n      });\r\n\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        setConversations(data.conversations || []);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching conversations:', error);\r\n      toast.error('Failed to load conversations');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const filteredConversations = conversations.filter(conv => {\r\n    const matchesSearch = conv.other_participant_name.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n                         conv.listing_title.toLowerCase().includes(searchTerm.toLowerCase());\r\n    \r\n    if (!matchesSearch) return false;\r\n    \r\n    switch (filterType) {\r\n      case 'unread':\r\n        return conv.unread_count > 0;\r\n      case 'owners':\r\n        return conv.other_participant_role === 'owner';\r\n      case 'tenants':\r\n        return conv.other_participant_role === 'tenant';\r\n      default:\r\n        return true;\r\n    }\r\n  });\r\n\r\n  const formatLastMessageTime = (timestamp?: string) => {\r\n    if (!timestamp) return '';\r\n    const date = new Date(timestamp);\r\n    const now = new Date();\r\n    const diffInHours = (now.getTime() - date.getTime()) / (1000 * 60 * 60);\r\n\r\n    if (diffInHours < 24) {\r\n      return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });\r\n    } else if (diffInHours < 168) { // 7 days\r\n      return date.toLocaleDateString([], { weekday: 'short' });\r\n    } else {\r\n      return date.toLocaleDateString([], { month: 'short', day: 'numeric' });\r\n    }\r\n  };\r\n\r\n  const handleConversationSelect = (conversation: Conversation) => {\r\n    setSelectedConversation(conversation);\r\n    \r\n    // Mark conversation as read when selected\r\n    if (conversation.unread_count > 0) {\r\n      markConversationAsRead(conversation.conversation_id);\r\n    }\r\n  };\r\n\r\n  const markConversationAsRead = async (conversationId: string) => {\r\n    try {\r\n      const token = localStorage.getItem('token');\r\n      await fetch(`http://localhost:5000/api/messages/conversations/${conversationId}/read`, {\r\n        method: 'PUT',\r\n        headers: {\r\n          'Authorization': `Bearer ${token}`,\r\n          'Content-Type': 'application/json'\r\n        }\r\n      });\r\n\r\n      // Update local state\r\n      setConversations(prev => \r\n        prev.map(conv => \r\n          conv.conversation_id === conversationId\r\n            ? { ...conv, unread_count: 0 }\r\n            : conv\r\n        )\r\n      );\r\n    } catch (error) {\r\n      console.error('Error marking conversation as read:', error);\r\n    }\r\n  };\r\n\r\n  const getTotalUnreadCount = () => {\r\n    return conversations.reduce((total, conv) => total + conv.unread_count, 0);\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-br from-gray-50 to-blue-50\">\r\n      {/* Header */}\r\n      <motion.div \r\n        initial={{ opacity: 0, y: -20 }}\r\n        animate={{ opacity: 1, y: 0 }}\r\n        className=\"bg-white shadow-lg border-b border-gray-200\"\r\n      >\r\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div className=\"flex items-center space-x-4\">\r\n              <h1 className=\"text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent\">\r\n                Messages\r\n              </h1>\r\n              {getTotalUnreadCount() > 0 && (\r\n                <div className=\"bg-red-500 text-white text-sm px-3 py-1 rounded-full font-medium\">\r\n                  {getTotalUnreadCount()} new\r\n                </div>\r\n              )}\r\n            </div>\r\n            <div className=\"flex items-center space-x-3\">\r\n              <button \r\n                onClick={() => {\r\n                  // This will be handled by the floating action button\r\n                  toast.info('Use the + button to start a new conversation');\r\n                }}\r\n                className=\"flex items-center px-4 py-2 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg hover:from-blue-700 hover:to-purple-700 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:scale-105\"\r\n              >\r\n                <Plus className=\"w-4 h-4 mr-2\" />\r\n                New Chat\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </motion.div>\r\n\r\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6\">\r\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6 h-[calc(100vh-200px)]\">\r\n          {/* Conversations List */}\r\n          <motion.div \r\n            initial={{ opacity: 0, x: -20 }}\r\n            animate={{ opacity: 1, x: 0 }}\r\n            className=\"lg:col-span-1 bg-white rounded-xl shadow-lg border border-gray-200\"\r\n          >\r\n            <div className=\"p-4 border-b border-gray-200\">\r\n              <div className=\"relative mb-4\">\r\n                <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400\" />\r\n                <input\r\n                  type=\"text\"\r\n                  placeholder=\"Search conversations...\"\r\n                  value={searchTerm}\r\n                  onChange={(e) => setSearchTerm(e.target.value)}\r\n                  className=\"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200\"\r\n                />\r\n              </div>\r\n              \r\n              {/* Filter Tabs */}\r\n              <div className=\"flex space-x-1 bg-gray-100 p-1 rounded-lg\">\r\n                {[\r\n                  { key: 'all', label: 'All', count: conversations.length },\r\n                  { key: 'unread', label: 'Unread', count: conversations.filter(c => c.unread_count > 0).length },\r\n                  { key: 'owners', label: 'Owners', count: conversations.filter(c => c.other_participant_role === 'owner').length },\r\n                  { key: 'tenants', label: 'Tenants', count: conversations.filter(c => c.other_participant_role === 'tenant').length }\r\n                ].map((filter) => (\r\n                  <button\r\n                    key={filter.key}\r\n                    onClick={() => setFilterType(filter.key as any)}\r\n                    className={`flex-1 px-3 py-2 text-sm font-medium rounded-md transition-all duration-200 ${\r\n                      filterType === filter.key\r\n                        ? 'bg-white text-blue-600 shadow-sm'\r\n                        : 'text-gray-600 hover:text-gray-900'\r\n                    }`}\r\n                  >\r\n                    {filter.label}\r\n                    {filter.count > 0 && (\r\n                      <span className=\"ml-1 text-xs bg-gray-200 text-gray-600 px-2 py-1 rounded-full\">\r\n                        {filter.count}\r\n                      </span>\r\n                    )}\r\n                  </button>\r\n                ))}\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"overflow-y-auto h-[calc(100%-140px)]\">\r\n              {loading ? (\r\n                <div className=\"flex justify-center items-center h-full\">\r\n                  <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\r\n                </div>\r\n              ) : filteredConversations.length === 0 ? (\r\n                <div className=\"flex flex-col items-center justify-center h-full text-gray-500 p-8\">\r\n                  <MessageSquare className=\"w-16 h-16 mb-4 text-gray-300\" />\r\n                  <p className=\"text-lg font-medium mb-2\">No conversations found</p>\r\n                  <p className=\"text-sm text-center\">\r\n                    {searchTerm || filterType !== 'all' \r\n                      ? 'Try adjusting your search or filters'\r\n                      : 'Start a conversation about a property'\r\n                    }\r\n                  </p>\r\n                </div>\r\n              ) : (\r\n                <div className=\"divide-y divide-gray-100\">\r\n                  <AnimatePresence>\r\n                    {filteredConversations.map((conversation, index) => (\r\n                      <motion.button\r\n                        key={conversation.conversation_id}\r\n                        initial={{ opacity: 0, y: 20 }}\r\n                        animate={{ opacity: 1, y: 0 }}\r\n                        transition={{ delay: index * 0.05 }}\r\n                        onClick={() => handleConversationSelect(conversation)}\r\n                        className={`w-full p-4 text-left hover:bg-gray-50 transition-all duration-200 ${\r\n                          selectedConversation?.conversation_id === conversation.conversation_id\r\n                            ? 'bg-blue-50 border-r-4 border-blue-600'\r\n                            : ''\r\n                        }`}\r\n                      >\r\n                        <div className=\"flex items-start space-x-3\">\r\n                          <div className=\"relative\">\r\n                            <div className=\"w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-medium flex-shrink-0\">\r\n                              {conversation.other_participant_avatar ? (\r\n                                <img\r\n                                  src={conversation.other_participant_avatar}\r\n                                  alt={conversation.other_participant_name}\r\n                                  className=\"w-12 h-12 rounded-full object-cover\"\r\n                                />\r\n                              ) : (\r\n                                conversation.other_participant_name.charAt(0).toUpperCase()\r\n                              )}\r\n                            </div>\r\n                            {conversation.unread_count > 0 && (\r\n                              <div className=\"absolute -top-1 -right-1 bg-red-500 text-white text-xs px-2 py-1 rounded-full min-w-[20px] text-center\">\r\n                                {conversation.unread_count}\r\n                              </div>\r\n                            )}\r\n                          </div>\r\n                          <div className=\"flex-1 min-w-0\">\r\n                            <div className=\"flex items-center justify-between mb-1\">\r\n                              <h3 className=\"font-semibold text-gray-900 truncate\">\r\n                                {conversation.other_participant_name}\r\n                              </h3>\r\n                              <span className=\"text-xs text-gray-500 flex-shrink-0\">\r\n                                {formatLastMessageTime(conversation.last_message_time)}\r\n                              </span>\r\n                            </div>\r\n                            <p className=\"text-sm text-gray-600 truncate mb-1\">\r\n                              {conversation.listing_title}\r\n                            </p>\r\n                            <div className=\"flex items-center justify-between\">\r\n                              {conversation.last_message && (\r\n                                <p className=\"text-sm text-gray-500 truncate flex-1\">\r\n                                  <span className={conversation.last_message_sender_id === user?.user_id ? 'text-blue-600 font-medium' : ''}>\r\n                                    {conversation.last_message_sender_id === user?.user_id ? 'You: ' : ''}\r\n                                  </span>\r\n                                  {conversation.last_message}\r\n                                </p>\r\n                              )}\r\n                              <div className=\"flex items-center space-x-2 ml-2\">\r\n                                <span className={`text-xs px-2 py-1 rounded-full ${\r\n                                  conversation.other_participant_role === 'owner' \r\n                                    ? 'bg-green-100 text-green-700' \r\n                                    : 'bg-blue-100 text-green-700'\r\n                                }`}>\r\n                                  {conversation.other_participant_role === 'owner' ? 'Owner' : 'Tenant'}\r\n                                </span>\r\n                                <span className=\"text-sm font-medium text-gray-900\">\r\n                                  ₹{conversation.listing_price.toLocaleString()}\r\n                                </span>\r\n                              </div>\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                      </motion.button>\r\n                    ))}\r\n                  </AnimatePresence>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </motion.div>\r\n\r\n          {/* Chat Interface */}\r\n          <motion.div \r\n            initial={{ opacity: 0, x: 20 }}\r\n            animate={{ opacity: 1, x: 0 }}\r\n            className=\"lg:col-span-2 bg-white rounded-xl shadow-lg border border-gray-200\"\r\n          >\r\n            {selectedConversation ? (\r\n              <ChatInterface\r\n                conversationId={selectedConversation.conversation_id}\r\n                otherParticipant={{\r\n                  name: selectedConversation.other_participant_name,\r\n                  avatar: selectedConversation.other_participant_avatar,\r\n                  id: selectedConversation.other_participant_id,\r\n                  role: selectedConversation.other_participant_role\r\n                }}\r\n                listingId={selectedConversation.listing_id}\r\n              />\r\n            ) : (\r\n              <div className=\"flex flex-col items-center justify-center h-full text-gray-500 p-8\">\r\n                <MessageSquare className=\"w-20 h-20 mb-6 text-gray-300\" />\r\n                <h3 className=\"text-xl font-semibold mb-3 text-gray-700\">Select a conversation</h3>\r\n                <p className=\"text-center text-gray-500 max-w-md\">\r\n                  Choose a conversation from the list to start messaging. \r\n                  You can search, filter, and manage all your property-related conversations here.\r\n                </p>\r\n              </div>\r\n            )}\r\n          </motion.div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Floating Action Button */}\r\n      <NewConversationButton />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default MessagesPage;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}