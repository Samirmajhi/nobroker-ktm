{"ast":null,"code":"import _objectSpread from\"/home/anonymous/Downloads/no-broker-kathmandu/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import{useState,useEffect}from'react';const VISIT_THRESHOLD=3;const AD_COOLDOWN=2*60*60*1000;// 2 hours in milliseconds\nexport const useVisitTracker=function(){let userType=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'tenant';const[visitData,setVisitData]=useState({visitCount:0,lastVisitTime:0,hasSeenAd:false,userType,lastAdShown:0});const[showAd,setShowAd]=useState(false);const[currentAd,setCurrentAd]=useState(null);useEffect(()=>{// Load visit data from localStorage\nconst savedData=localStorage.getItem(\"visitTracker_\".concat(userType));if(savedData){try{const parsed=JSON.parse(savedData);setVisitData(_objectSpread(_objectSpread({},parsed),{},{userType}));}catch(error){console.error('Error parsing visit data:',error);}}else{// Initialize with user type\nsetVisitData(prev=>_objectSpread(_objectSpread({},prev),{},{userType}));}},[userType]);const trackVisit=async()=>{const now=Date.now();const newVisitData=_objectSpread(_objectSpread({},visitData),{},{visitCount:visitData.visitCount+1,lastVisitTime:now,userType});setVisitData(newVisitData);localStorage.setItem(\"visitTracker_\".concat(userType),JSON.stringify(newVisitData));// Check if we should show an ad\nif(shouldShowAd(newVisitData,now)){await fetchAndShowAd();}};const shouldShowAd=(data,now)=>{return data.visitCount>=VISIT_THRESHOLD&&!data.hasSeenAd&&now-data.lastAdShown>AD_COOLDOWN;};const fetchAndShowAd=async()=>{try{// Fetch ads from backend\nconst response=await fetch(\"/api/ads/active?userType=\".concat(userType),{headers:{Authorization:\"Bearer \".concat(localStorage.getItem('token'))}});if(response.ok){const ads=await response.json();if(ads.length>0){// Select ad based on priority and target audience\nconst relevantAds=ads.filter(ad=>ad.isActive&&(ad.targetAudience.includes(userType)||ad.targetAudience.includes('all')));if(relevantAds.length>0){const selectedAd=relevantAds.sort((a,b)=>b.priority-a.priority)[0];setCurrentAd(selectedAd);setShowAd(true);}}}else{// Fallback to default ad\nsetCurrentAd(getDefaultAd());setShowAd(true);}}catch(error){console.error('Error fetching ads:',error);// Fallback to default ad\nsetCurrentAd(getDefaultAd());setShowAd(true);}};const getDefaultAd=()=>{const defaultAds={tenant:{id:'default_tenant',title:'Find Your Perfect Home!',description:'Discover amazing properties with our premium search features. Get instant notifications for new listings that match your preferences.',duration:15,isActive:true,targetAudience:['tenant'],priority:1},owner:{id:'default_owner',title:'List Your Property Today!',description:'Reach thousands of potential tenants. Our premium listing features help you find the right match faster.',duration:15,isActive:true,targetAudience:['owner'],priority:1},staff:{id:'default_staff',title:'Premium Analytics Dashboard',description:'Access advanced reporting and analytics features to better manage your platform.',duration:15,isActive:true,targetAudience:['all'],priority:1},admin:{id:'default_admin',title:'Admin Tools & Analytics',description:'Comprehensive admin tools and analytics to manage your platform effectively.',duration:15,isActive:true,targetAudience:['all'],priority:1}};return defaultAds[userType]||defaultAds.tenant;};const markAdAsSeen=()=>{const now=Date.now();const updatedData=_objectSpread(_objectSpread({},visitData),{},{hasSeenAd:true,lastAdShown:now});setVisitData(updatedData);localStorage.setItem(\"visitTracker_\".concat(userType),JSON.stringify(updatedData));setShowAd(false);setCurrentAd(null);};const skipAd=()=>{setShowAd(false);setCurrentAd(null);// Reset visit count after showing ad\nconst resetData=_objectSpread(_objectSpread({},visitData),{},{visitCount:0,hasSeenAd:false,lastAdShown:Date.now()});setVisitData(resetData);localStorage.setItem(\"visitTracker_\".concat(userType),JSON.stringify(resetData));};const resetVisitCount=()=>{const resetData={visitCount:0,lastVisitTime:Date.now(),hasSeenAd:false,userType,lastAdShown:0};setVisitData(resetData);localStorage.setItem(\"visitTracker_\".concat(userType),JSON.stringify(resetData));};return{visitCount:visitData.visitCount,showAd,currentAd,trackVisit,markAdAsSeen,skipAd,resetVisitCount,userType};};","map":{"version":3,"names":["useState","useEffect","VISIT_THRESHOLD","AD_COOLDOWN","useVisitTracker","userType","arguments","length","undefined","visitData","setVisitData","visitCount","lastVisitTime","hasSeenAd","lastAdShown","showAd","setShowAd","currentAd","setCurrentAd","savedData","localStorage","getItem","concat","parsed","JSON","parse","_objectSpread","error","console","prev","trackVisit","now","Date","newVisitData","setItem","stringify","shouldShowAd","fetchAndShowAd","data","response","fetch","headers","Authorization","ok","ads","json","relevantAds","filter","ad","isActive","targetAudience","includes","selectedAd","sort","a","b","priority","getDefaultAd","defaultAds","tenant","id","title","description","duration","owner","staff","admin","markAdAsSeen","updatedData","skipAd","resetData","resetVisitCount"],"sources":["/home/anonymous/Downloads/no-broker-kathmandu/frontend/src/hooks/useVisitTracker.ts"],"sourcesContent":["import { useState, useEffect } from 'react';\r\n\r\ninterface VisitData {\r\n  visitCount: number;\r\n  lastVisitTime: number;\r\n  hasSeenAd: boolean;\r\n  userType: 'tenant' | 'owner' | 'staff' | 'admin';\r\n  lastAdShown: number;\r\n}\r\n\r\ninterface AdData {\r\n  id: string;\r\n  title: string;\r\n  description: string;\r\n  imageUrl?: string;\r\n  videoUrl?: string;\r\n  clickUrl?: string;\r\n  duration: number; // in seconds\r\n  isActive: boolean;\r\n  targetAudience: ('tenant' | 'owner' | 'all')[];\r\n  priority: number;\r\n}\r\n\r\nconst VISIT_THRESHOLD = 3;\r\nconst AD_COOLDOWN = 2 * 60 * 60 * 1000; // 2 hours in milliseconds\r\n\r\nexport const useVisitTracker = (userType: 'tenant' | 'owner' | 'staff' | 'admin' = 'tenant') => {\r\n  const [visitData, setVisitData] = useState<VisitData>({\r\n    visitCount: 0,\r\n    lastVisitTime: 0,\r\n    hasSeenAd: false,\r\n    userType,\r\n    lastAdShown: 0\r\n  });\r\n  const [showAd, setShowAd] = useState(false);\r\n  const [currentAd, setCurrentAd] = useState<AdData | null>(null);\r\n\r\n  useEffect(() => {\r\n    // Load visit data from localStorage\r\n    const savedData = localStorage.getItem(`visitTracker_${userType}`);\r\n    if (savedData) {\r\n      try {\r\n        const parsed = JSON.parse(savedData);\r\n        setVisitData({ ...parsed, userType });\r\n      } catch (error) {\r\n        console.error('Error parsing visit data:', error);\r\n      }\r\n    } else {\r\n      // Initialize with user type\r\n      setVisitData(prev => ({ ...prev, userType }));\r\n    }\r\n  }, [userType]);\r\n\r\n  const trackVisit = async () => {\r\n    const now = Date.now();\r\n    const newVisitData = {\r\n      ...visitData,\r\n      visitCount: visitData.visitCount + 1,\r\n      lastVisitTime: now,\r\n      userType\r\n    };\r\n\r\n    setVisitData(newVisitData);\r\n    localStorage.setItem(`visitTracker_${userType}`, JSON.stringify(newVisitData));\r\n\r\n    // Check if we should show an ad\r\n    if (shouldShowAd(newVisitData, now)) {\r\n      await fetchAndShowAd();\r\n    }\r\n  };\r\n\r\n  const shouldShowAd = (data: VisitData, now: number): boolean => {\r\n    return (\r\n      data.visitCount >= VISIT_THRESHOLD &&\r\n      !data.hasSeenAd &&\r\n      (now - data.lastAdShown) > AD_COOLDOWN\r\n    );\r\n  };\r\n\r\n  const fetchAndShowAd = async () => {\r\n    try {\r\n      // Fetch ads from backend\r\n      const response = await fetch(`/api/ads/active?userType=${userType}`, {\r\n        headers: { Authorization: `Bearer ${localStorage.getItem('token')}` }\r\n      });\r\n      \r\n      if (response.ok) {\r\n        const ads = await response.json();\r\n        if (ads.length > 0) {\r\n          // Select ad based on priority and target audience\r\n          const relevantAds = ads.filter((ad: AdData) => \r\n            ad.isActive && \r\n            (ad.targetAudience.includes(userType as 'tenant' | 'owner' | 'all') || ad.targetAudience.includes('all'))\r\n          );\r\n          \r\n          if (relevantAds.length > 0) {\r\n            const selectedAd = relevantAds.sort((a: AdData, b: AdData) => b.priority - a.priority)[0];\r\n            setCurrentAd(selectedAd);\r\n            setShowAd(true);\r\n          }\r\n        }\r\n      } else {\r\n        // Fallback to default ad\r\n        setCurrentAd(getDefaultAd());\r\n        setShowAd(true);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching ads:', error);\r\n      // Fallback to default ad\r\n      setCurrentAd(getDefaultAd());\r\n      setShowAd(true);\r\n    }\r\n  };\r\n\r\n  const getDefaultAd = (): AdData => {\r\n    const defaultAds = {\r\n      tenant: {\r\n        id: 'default_tenant',\r\n        title: 'Find Your Perfect Home!',\r\n        description: 'Discover amazing properties with our premium search features. Get instant notifications for new listings that match your preferences.',\r\n        duration: 15,\r\n        isActive: true,\r\n        targetAudience: ['tenant'] as ('tenant' | 'owner' | 'all')[],\r\n        priority: 1\r\n      },\r\n      owner: {\r\n        id: 'default_owner',\r\n        title: 'List Your Property Today!',\r\n        description: 'Reach thousands of potential tenants. Our premium listing features help you find the right match faster.',\r\n        duration: 15,\r\n        isActive: true,\r\n        targetAudience: ['owner'] as ('tenant' | 'owner' | 'all')[],\r\n        priority: 1\r\n      },\r\n      staff: {\r\n        id: 'default_staff',\r\n        title: 'Premium Analytics Dashboard',\r\n        description: 'Access advanced reporting and analytics features to better manage your platform.',\r\n        duration: 15,\r\n        isActive: true,\r\n        targetAudience: ['all'] as ('tenant' | 'owner' | 'all')[],\r\n        priority: 1\r\n      },\r\n      admin: {\r\n        id: 'default_admin',\r\n        title: 'Admin Tools & Analytics',\r\n        description: 'Comprehensive admin tools and analytics to manage your platform effectively.',\r\n        duration: 15,\r\n        isActive: true,\r\n        targetAudience: ['all'] as ('tenant' | 'owner' | 'all')[],\r\n        priority: 1\r\n      }\r\n    };\r\n\r\n    return defaultAds[userType] || defaultAds.tenant;\r\n  };\r\n\r\n  const markAdAsSeen = () => {\r\n    const now = Date.now();\r\n    const updatedData = {\r\n      ...visitData,\r\n      hasSeenAd: true,\r\n      lastAdShown: now\r\n    };\r\n    setVisitData(updatedData);\r\n    localStorage.setItem(`visitTracker_${userType}`, JSON.stringify(updatedData));\r\n    setShowAd(false);\r\n    setCurrentAd(null);\r\n  };\r\n\r\n  const skipAd = () => {\r\n    setShowAd(false);\r\n    setCurrentAd(null);\r\n    // Reset visit count after showing ad\r\n    const resetData = {\r\n      ...visitData,\r\n      visitCount: 0,\r\n      hasSeenAd: false,\r\n      lastAdShown: Date.now()\r\n    };\r\n    setVisitData(resetData);\r\n    localStorage.setItem(`visitTracker_${userType}`, JSON.stringify(resetData));\r\n  };\r\n\r\n  const resetVisitCount = () => {\r\n    const resetData = {\r\n      visitCount: 0,\r\n      lastVisitTime: Date.now(),\r\n      hasSeenAd: false,\r\n      userType,\r\n      lastAdShown: 0\r\n    };\r\n    setVisitData(resetData);\r\n    localStorage.setItem(`visitTracker_${userType}`, JSON.stringify(resetData));\r\n  };\r\n\r\n  return {\r\n    visitCount: visitData.visitCount,\r\n    showAd,\r\n    currentAd,\r\n    trackVisit,\r\n    markAdAsSeen,\r\n    skipAd,\r\n    resetVisitCount,\r\n    userType\r\n  };\r\n};\r\n"],"mappings":"2IAAA,OAASA,QAAQ,CAAEC,SAAS,KAAQ,OAAO,CAuB3C,KAAM,CAAAC,eAAe,CAAG,CAAC,CACzB,KAAM,CAAAC,WAAW,CAAG,CAAC,CAAG,EAAE,CAAG,EAAE,CAAG,IAAI,CAAE;AAExC,MAAO,MAAM,CAAAC,eAAe,CAAG,QAAAA,CAAA,CAAiE,IAAhE,CAAAC,QAAgD,CAAAC,SAAA,CAAAC,MAAA,IAAAD,SAAA,MAAAE,SAAA,CAAAF,SAAA,IAAG,QAAQ,CACzF,KAAM,CAACG,SAAS,CAAEC,YAAY,CAAC,CAAGV,QAAQ,CAAY,CACpDW,UAAU,CAAE,CAAC,CACbC,aAAa,CAAE,CAAC,CAChBC,SAAS,CAAE,KAAK,CAChBR,QAAQ,CACRS,WAAW,CAAE,CACf,CAAC,CAAC,CACF,KAAM,CAACC,MAAM,CAAEC,SAAS,CAAC,CAAGhB,QAAQ,CAAC,KAAK,CAAC,CAC3C,KAAM,CAACiB,SAAS,CAAEC,YAAY,CAAC,CAAGlB,QAAQ,CAAgB,IAAI,CAAC,CAE/DC,SAAS,CAAC,IAAM,CACd;AACA,KAAM,CAAAkB,SAAS,CAAGC,YAAY,CAACC,OAAO,iBAAAC,MAAA,CAAiBjB,QAAQ,CAAE,CAAC,CAClE,GAAIc,SAAS,CAAE,CACb,GAAI,CACF,KAAM,CAAAI,MAAM,CAAGC,IAAI,CAACC,KAAK,CAACN,SAAS,CAAC,CACpCT,YAAY,CAAAgB,aAAA,CAAAA,aAAA,IAAMH,MAAM,MAAElB,QAAQ,EAAE,CAAC,CACvC,CAAE,MAAOsB,KAAK,CAAE,CACdC,OAAO,CAACD,KAAK,CAAC,2BAA2B,CAAEA,KAAK,CAAC,CACnD,CACF,CAAC,IAAM,CACL;AACAjB,YAAY,CAACmB,IAAI,EAAAH,aAAA,CAAAA,aAAA,IAAUG,IAAI,MAAExB,QAAQ,EAAG,CAAC,CAC/C,CACF,CAAC,CAAE,CAACA,QAAQ,CAAC,CAAC,CAEd,KAAM,CAAAyB,UAAU,CAAG,KAAAA,CAAA,GAAY,CAC7B,KAAM,CAAAC,GAAG,CAAGC,IAAI,CAACD,GAAG,CAAC,CAAC,CACtB,KAAM,CAAAE,YAAY,CAAAP,aAAA,CAAAA,aAAA,IACbjB,SAAS,MACZE,UAAU,CAAEF,SAAS,CAACE,UAAU,CAAG,CAAC,CACpCC,aAAa,CAAEmB,GAAG,CAClB1B,QAAQ,EACT,CAEDK,YAAY,CAACuB,YAAY,CAAC,CAC1Bb,YAAY,CAACc,OAAO,iBAAAZ,MAAA,CAAiBjB,QAAQ,EAAImB,IAAI,CAACW,SAAS,CAACF,YAAY,CAAC,CAAC,CAE9E;AACA,GAAIG,YAAY,CAACH,YAAY,CAAEF,GAAG,CAAC,CAAE,CACnC,KAAM,CAAAM,cAAc,CAAC,CAAC,CACxB,CACF,CAAC,CAED,KAAM,CAAAD,YAAY,CAAGA,CAACE,IAAe,CAAEP,GAAW,GAAc,CAC9D,MACE,CAAAO,IAAI,CAAC3B,UAAU,EAAIT,eAAe,EAClC,CAACoC,IAAI,CAACzB,SAAS,EACdkB,GAAG,CAAGO,IAAI,CAACxB,WAAW,CAAIX,WAAW,CAE1C,CAAC,CAED,KAAM,CAAAkC,cAAc,CAAG,KAAAA,CAAA,GAAY,CACjC,GAAI,CACF;AACA,KAAM,CAAAE,QAAQ,CAAG,KAAM,CAAAC,KAAK,6BAAAlB,MAAA,CAA6BjB,QAAQ,EAAI,CACnEoC,OAAO,CAAE,CAAEC,aAAa,WAAApB,MAAA,CAAYF,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,CAAG,CACtE,CAAC,CAAC,CAEF,GAAIkB,QAAQ,CAACI,EAAE,CAAE,CACf,KAAM,CAAAC,GAAG,CAAG,KAAM,CAAAL,QAAQ,CAACM,IAAI,CAAC,CAAC,CACjC,GAAID,GAAG,CAACrC,MAAM,CAAG,CAAC,CAAE,CAClB;AACA,KAAM,CAAAuC,WAAW,CAAGF,GAAG,CAACG,MAAM,CAAEC,EAAU,EACxCA,EAAE,CAACC,QAAQ,GACVD,EAAE,CAACE,cAAc,CAACC,QAAQ,CAAC9C,QAAsC,CAAC,EAAI2C,EAAE,CAACE,cAAc,CAACC,QAAQ,CAAC,KAAK,CAAC,CAC1G,CAAC,CAED,GAAIL,WAAW,CAACvC,MAAM,CAAG,CAAC,CAAE,CAC1B,KAAM,CAAA6C,UAAU,CAAGN,WAAW,CAACO,IAAI,CAAC,CAACC,CAAS,CAAEC,CAAS,GAAKA,CAAC,CAACC,QAAQ,CAAGF,CAAC,CAACE,QAAQ,CAAC,CAAC,CAAC,CAAC,CACzFtC,YAAY,CAACkC,UAAU,CAAC,CACxBpC,SAAS,CAAC,IAAI,CAAC,CACjB,CACF,CACF,CAAC,IAAM,CACL;AACAE,YAAY,CAACuC,YAAY,CAAC,CAAC,CAAC,CAC5BzC,SAAS,CAAC,IAAI,CAAC,CACjB,CACF,CAAE,MAAOW,KAAK,CAAE,CACdC,OAAO,CAACD,KAAK,CAAC,qBAAqB,CAAEA,KAAK,CAAC,CAC3C;AACAT,YAAY,CAACuC,YAAY,CAAC,CAAC,CAAC,CAC5BzC,SAAS,CAAC,IAAI,CAAC,CACjB,CACF,CAAC,CAED,KAAM,CAAAyC,YAAY,CAAGA,CAAA,GAAc,CACjC,KAAM,CAAAC,UAAU,CAAG,CACjBC,MAAM,CAAE,CACNC,EAAE,CAAE,gBAAgB,CACpBC,KAAK,CAAE,yBAAyB,CAChCC,WAAW,CAAE,uIAAuI,CACpJC,QAAQ,CAAE,EAAE,CACZd,QAAQ,CAAE,IAAI,CACdC,cAAc,CAAE,CAAC,QAAQ,CAAmC,CAC5DM,QAAQ,CAAE,CACZ,CAAC,CACDQ,KAAK,CAAE,CACLJ,EAAE,CAAE,eAAe,CACnBC,KAAK,CAAE,2BAA2B,CAClCC,WAAW,CAAE,0GAA0G,CACvHC,QAAQ,CAAE,EAAE,CACZd,QAAQ,CAAE,IAAI,CACdC,cAAc,CAAE,CAAC,OAAO,CAAmC,CAC3DM,QAAQ,CAAE,CACZ,CAAC,CACDS,KAAK,CAAE,CACLL,EAAE,CAAE,eAAe,CACnBC,KAAK,CAAE,6BAA6B,CACpCC,WAAW,CAAE,kFAAkF,CAC/FC,QAAQ,CAAE,EAAE,CACZd,QAAQ,CAAE,IAAI,CACdC,cAAc,CAAE,CAAC,KAAK,CAAmC,CACzDM,QAAQ,CAAE,CACZ,CAAC,CACDU,KAAK,CAAE,CACLN,EAAE,CAAE,eAAe,CACnBC,KAAK,CAAE,yBAAyB,CAChCC,WAAW,CAAE,8EAA8E,CAC3FC,QAAQ,CAAE,EAAE,CACZd,QAAQ,CAAE,IAAI,CACdC,cAAc,CAAE,CAAC,KAAK,CAAmC,CACzDM,QAAQ,CAAE,CACZ,CACF,CAAC,CAED,MAAO,CAAAE,UAAU,CAACrD,QAAQ,CAAC,EAAIqD,UAAU,CAACC,MAAM,CAClD,CAAC,CAED,KAAM,CAAAQ,YAAY,CAAGA,CAAA,GAAM,CACzB,KAAM,CAAApC,GAAG,CAAGC,IAAI,CAACD,GAAG,CAAC,CAAC,CACtB,KAAM,CAAAqC,WAAW,CAAA1C,aAAA,CAAAA,aAAA,IACZjB,SAAS,MACZI,SAAS,CAAE,IAAI,CACfC,WAAW,CAAEiB,GAAG,EACjB,CACDrB,YAAY,CAAC0D,WAAW,CAAC,CACzBhD,YAAY,CAACc,OAAO,iBAAAZ,MAAA,CAAiBjB,QAAQ,EAAImB,IAAI,CAACW,SAAS,CAACiC,WAAW,CAAC,CAAC,CAC7EpD,SAAS,CAAC,KAAK,CAAC,CAChBE,YAAY,CAAC,IAAI,CAAC,CACpB,CAAC,CAED,KAAM,CAAAmD,MAAM,CAAGA,CAAA,GAAM,CACnBrD,SAAS,CAAC,KAAK,CAAC,CAChBE,YAAY,CAAC,IAAI,CAAC,CAClB;AACA,KAAM,CAAAoD,SAAS,CAAA5C,aAAA,CAAAA,aAAA,IACVjB,SAAS,MACZE,UAAU,CAAE,CAAC,CACbE,SAAS,CAAE,KAAK,CAChBC,WAAW,CAAEkB,IAAI,CAACD,GAAG,CAAC,CAAC,EACxB,CACDrB,YAAY,CAAC4D,SAAS,CAAC,CACvBlD,YAAY,CAACc,OAAO,iBAAAZ,MAAA,CAAiBjB,QAAQ,EAAImB,IAAI,CAACW,SAAS,CAACmC,SAAS,CAAC,CAAC,CAC7E,CAAC,CAED,KAAM,CAAAC,eAAe,CAAGA,CAAA,GAAM,CAC5B,KAAM,CAAAD,SAAS,CAAG,CAChB3D,UAAU,CAAE,CAAC,CACbC,aAAa,CAAEoB,IAAI,CAACD,GAAG,CAAC,CAAC,CACzBlB,SAAS,CAAE,KAAK,CAChBR,QAAQ,CACRS,WAAW,CAAE,CACf,CAAC,CACDJ,YAAY,CAAC4D,SAAS,CAAC,CACvBlD,YAAY,CAACc,OAAO,iBAAAZ,MAAA,CAAiBjB,QAAQ,EAAImB,IAAI,CAACW,SAAS,CAACmC,SAAS,CAAC,CAAC,CAC7E,CAAC,CAED,MAAO,CACL3D,UAAU,CAAEF,SAAS,CAACE,UAAU,CAChCI,MAAM,CACNE,SAAS,CACTa,UAAU,CACVqC,YAAY,CACZE,MAAM,CACNE,eAAe,CACflE,QACF,CAAC,CACH,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}